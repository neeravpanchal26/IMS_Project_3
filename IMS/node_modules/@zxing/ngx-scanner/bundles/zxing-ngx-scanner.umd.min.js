!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zxing/library"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("@zxing/ngx-scanner",["exports","@zxing/library","rxjs","rxjs/operators","@angular/core","@angular/common","@angular/forms"],t):t((e.zxing=e.zxing||{},e.zxing["ngx-scanner"]={}),e.library,e.rxjs,e.Rx.Observable.prototype,e.ng.core,e.ng.common,e.ng.forms)}(this,function(e,r,o,i,t,n,s){"use strict";var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function c(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(t,s,a,c){return new(a||(a=Promise))(function(e,n){function i(e){try{o(c.next(e))}catch(t){n(t)}}function r(e){try{o(c["throw"](e))}catch(t){n(t)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(i,r)}o((c=c.apply(t,s||[])).next())})}function d(n,i){var r,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=2&e[0]?o["return"]:e[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=i.call(n,a)}catch(t){e=[6,t],o=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var h=function(){function e(e,t){void 0===t&&(t=500),this.reader=e,this.timeBetweenScans=t,this.torchCompatible=new o.BehaviorSubject(!1)}return e.prototype.decodeFromInputVideoDevice=function(r,o,s){return u(this,void 0,void 0,function(){var t,n,i;return d(this,function(e){switch(e.label){case 0:if(this.reset(),this.prepareVideoElement(s),void 0!==o&&(this.deviceId=o),t={audio:!1,video:void 0===o?{facingMode:{exact:"environment"}}:{deviceId:{exact:o}}},"undefined"==typeof navigator)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia(t)];case 2:return n=e.sent(),this.startDecodeFromStream(n,r),[3,4];case 3:return i=e.sent(),console.error(i),[3,4];case 4:return[2]}})})},e.prototype.startDecodeFromStream=function(e,t){this.stream=e,this.checkTorchCompatibility(this.stream),this.bindVideoSrc(this.videoElement,this.stream),this.bindEvents(this.videoElement,t)},e.prototype.bindVideoSrc=function(e,t){try{e.srcObject=t}catch(n){e.src=window.URL.createObjectURL(t)}},e.prototype.unbindVideoSrc=function(e){try{e.srcObject=null}catch(t){e.src=""}},e.prototype.bindEvents=function(e,t){var n=this;void 0!==t&&(this.videoPlayingEventListener=function(){return n.decodingStream=n.decodeWithDelay(n.timeBetweenScans).pipe(i.catchError(function(e,t){return n.handleDecodeStreamError(e,t)})).subscribe(function(e){return t(e)})}),e.addEventListener("playing",this.videoPlayingEventListener),this.videoLoadedMetadataEventListener=function(){return e.play()},e.addEventListener("loadedmetadata",this.videoLoadedMetadataEventListener)},e.prototype.checkTorchCompatibility=function(i){return u(this,void 0,void 0,function(){var t,n;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.track=i.getVideoTracks()[0],[4,new ImageCapture(this.track).getPhotoCapabilities()];case 1:return t=e.sent(),n=!!t.torch||"fillLightMode"in t&&0!==t.fillLightMode.length,this.torchCompatible.next(n),[3,3];case 2:return e.sent(),this.torchCompatible.next(!1),[3,3];case 3:return[2]}})})},e.prototype.setTorch=function(e){this.torchCompatible.value&&(e?this.track.applyConstraints({advanced:[{torch:!0}]}):this.restart())},Object.defineProperty(e.prototype,"torchAvailable",{get:function(){return this.torchCompatible.asObservable()},enumerable:!0,configurable:!0}),e.prototype.prepareVideoElement=function(e){e||"undefined"==typeof document||((e=document.createElement("video")).width=200,e.height=200),this.videoElement=e},e.prototype.decodeWithDelay=function(n){var i=this;return void 0===n&&(n=500),o.Observable.create(function(t){var e=setInterval(function(){try{t.next(i.decode())}catch(e){t.error(e)}},n);return function(){return clearInterval(e)}})},e.prototype.decode=function(){var e=this.createBinaryBitmap(this.videoElement||this.imageElement);return this.decodeBitmap(e)},e.prototype.decodeBitmap=function(e){return this.reader.decode(e)},e.prototype.handleDecodeStreamError=function(e,t){if(e instanceof r.NotFoundException||e instanceof r.ChecksumException||e instanceof r.FormatException)return t;throw e},e.prototype.createBinaryBitmap=function(e){undefined===this.canvasElementContext&&this.prepareCaptureCanvas(),this.canvasElementContext.drawImage(e,0,0);var t=new r.HTMLCanvasElementLuminanceSource(this.canvasElement),n=new r.HybridBinarizer(t);return new r.BinaryBitmap(n)},e.prototype.prepareCaptureCanvas=function(){if("undefined"==typeof document)return this.canvasElement=undefined,void(this.canvasElementContext=undefined);var e,t,n=document.createElement("canvas");"undefined"!=typeof this.videoElement&&(e=this.videoElement.videoWidth,t=this.videoElement.videoHeight),"undefined"!=typeof this.imageElement&&(e=this.imageElement.naturalWidth||this.imageElement.width,t=this.imageElement.naturalHeight||this.imageElement.height),n.style.width=e+"px",n.style.height=t+"px",n.width=e,n.height=t,this.canvasElement=n,this.canvasElementContext=n.getContext("2d")},e.prototype.stop=function(){this.decodingStream&&this.decodingStream.unsubscribe(),this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=undefined)},e.prototype.reset=function(){this.stop(),this.videoElement&&("undefined"!=typeof this.videoPlayEndedEventListener&&this.videoElement.removeEventListener("ended",this.videoPlayEndedEventListener),"undefined"!=typeof this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),"undefined"!=typeof this.videoLoadedMetadataEventListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoLoadedMetadataEventListener),this.unbindVideoSrc(this.videoElement),this.videoElement.removeAttribute("src"),this.videoElement=undefined),this.imageElement&&(undefined!==this.videoPlayEndedEventListener&&this.imageElement.removeEventListener("load",this.imageLoadedEventListener),this.imageElement.src=undefined,this.imageElement.removeAttribute("src"),this.imageElement=undefined),this.canvasElementContext=undefined,this.canvasElement=undefined},e.prototype.restart=function(){this.decodeFromInputVideoDevice(undefined,this.deviceId,this.videoElement)},e}(),p=function(i){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=500);var n=new r.MultiFormatReader;return n.setHints(e),i.call(this,n,t)||this}return c(e,i),e.prototype.decodeBitmap=function(e){return this.reader.decodeWithState(e)},e}(h),l=function(t){function e(e){return void 0===e&&(e=500),t.call(this,new r.QRCodeReader,e)||this}return c(e,t),e}(h),v=function(){function e(){this._formats=[r.BarcodeFormat.QR_CODE],this.scannerEnabled=!0,this.autofocusEnabled=!0,this.previewFitMode="cover",this.torchCompatible=new t.EventEmitter,this.scanSuccess=new t.EventEmitter,this.scanFailure=new t.EventEmitter,this.scanError=new t.EventEmitter,this.scanComplete=new t.EventEmitter,this.camerasFound=new t.EventEmitter,this.camerasNotFound=new t.EventEmitter,this.permissionResponse=new t.EventEmitter,this.hasDevices=new t.EventEmitter,this.codeReader=new l,this.hasNavigator="undefined"!=typeof navigator,this.isMediaDevicesSuported=this.hasNavigator&&!!navigator.mediaDevices,this.isEnumerateDevicesSuported=!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}return Object.defineProperty(e.prototype,"_hasDevices",{set:function(e){this.hasDevices.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formats",{get:function(){return this._formats},set:function(e){var t=e;this._formats=t.map(function(e){return"string"==typeof e?r.BarcodeFormat[e.trim()]:e})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"torch",{set:function(e){this.codeReader.setTorch(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.scannerEnabled&&(this.scannerEnabled?this.videoInputDevice&&this.scan(this.videoInputDevice.deviceId):this.resetScan()),e.device&&(this.device?this.changeDevice(this.device):(console.warn("zxing-scanner","device","Unselected device."),this.resetScan())),e.formats!==undefined&&this.setFormats(this.formats)},e.prototype.ngAfterViewInit=function(){return u(this,void 0,void 0,function(){var t,n=this;return d(this,function(e){switch(e.label){case 0:return this.previewElemRef?(this.previewElemRef.nativeElement.setAttribute("autoplay",!1),this.previewElemRef.nativeElement.setAttribute("muted",!0),this.previewElemRef.nativeElement.setAttribute("playsinline",!0),this.previewElemRef.nativeElement.setAttribute("autofocus",this.autofocusEnabled),[4,this.askForPermission()]):(console.warn("zxing-scanner","Preview element not found!"),[2]);case 1:return t=e.sent(),this.enumarateVideoDevices().then(function(e){e&&0<e.length?(n._hasDevices=!0,n.camerasFound.next(e)):(n._hasDevices=!1,n.camerasNotFound.next())}),!0!==t?[2]:(this.startScan(this.videoInputDevice),this.codeReader.torchAvailable.subscribe(function(e){n.torchCompatible.emit(e)}),[2])}})})},e.prototype.ngOnDestroy=function(){this.resetScan()},e.prototype.setFormats=function(e){this.formats=e;var t=new Map;t.set(2,e),this.codeReader=new p(t),this.restartScan()},e.prototype.changeDevice=function(e){this.videoInputDevice=e,this.startScan(e)},e.prototype.changeDeviceById=function(e){this.changeDevice(this.getDeviceById(e))},e.prototype.getDeviceById=function(t){return this.videoInputDevices.find(function(e){return e.deviceId===t})},e.prototype.setPermission=function(e){return this.hasPermission=e,this.permissionResponse.next(e),this.permissionResponse},e.prototype.askForPermission=function(){return u(this,void 0,void 0,function(){var n,i,r;return d(this,function(e){switch(e.label){case 0:if(!this.hasNavigator)return console.error("zxing-scanner","askForPermission","Can't ask permission, navigator is not present."),this.setPermission(null),[2,this.hasPermission];if(!this.isMediaDevicesSuported)return console.error("zxing-scanner","askForPermission","Can't get user media, this is not supported."),this.setPermission(null),[2,this.hasPermission];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 2:return n=e.sent(),[3,4];case 3:return i=e.sent(),[2,this.handlePermissionException(i)];case 4:try{this.codeReader.bindVideoSrc(this.previewElemRef.nativeElement,n),n.getVideoTracks().forEach(function(e){e.stop()}),this.codeReader.unbindVideoSrc(this.previewElemRef.nativeElement),r=!0,this.setPermission(r)}catch(t){console.error("zxing-scanner","askForPermission",t),r=null,this.setPermission(r)}return[2,r]}})})},e.prototype.handlePermissionException=function(e){var t;switch(console.warn("zxing-scanner","askForPermission",e),e.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",e.message),t=null,this._hasDevices=null;break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",e.message),t=!1,this._hasDevices=!0;break;case"NotFoundError":console.warn("@zxing/ngx-scanner",e.message),t=null,this._hasDevices=!1,this.camerasNotFound.next(e);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),t=null,this._hasDevices=!1,this.camerasNotFound.next(e);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",e),t=null}return this.setPermission(t),this.permissionResponse.error(e),t},e.prototype.scan=function(e){var t=this;try{this.codeReader.decodeFromInputVideoDevice(function(e){e?t.dispatchScanSuccess(e):t.dispatchScanFailure(),t.dispatchScanComplete(e)},e,this.previewElemRef.nativeElement)}catch(n){this.dispatchScanError(n),this.dispatchScanComplete(undefined)}},e.prototype.startScan=function(e){this.scannerEnabled&&e&&this.scan(e.deviceId)},e.prototype.resetScan=function(){this.codeReader.reset()},e.prototype.restartScan=function(){this.resetScan(),this.startScan(this.device)},e.prototype.dispatchScanSuccess=function(e){this.scanSuccess.next(e.getText())},e.prototype.dispatchScanFailure=function(){this.scanFailure.next()},e.prototype.dispatchScanError=function(e){this.scanError.next(e)},e.prototype.dispatchScanComplete=function(e){this.scanComplete.next(e)},e.prototype.enumarateVideoDevices=function(){return u(this,void 0,void 0,function(){var n,i,r,o,s,a,c,u;return d(this,function(e){switch(e.label){case 0:return this.hasNavigator?this.isEnumerateDevicesSuported?[4,navigator.mediaDevices.enumerateDevices()]:(console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, method not supported."),[2]):(console.error("zxing-scanner","enumarateVideoDevices","Can't enumerate devices, navigator is not present."),[2]);case 1:n=e.sent(),this.videoInputDevices=[];try{for(i=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(n),r=i.next();!r.done;r=i.next()){for(a in o=r.value,s={},o)s[a]=o[a];"video"===s.kind&&(s.kind="videoinput"),s.deviceId||(s.deviceId=s.id),s.label||(s.label="Camera (no permission 🚫)"),"videoinput"===s.kind&&this.videoInputDevices.push(s)}}catch(t){c={error:t}}finally{try{r&&!r.done&&(u=i["return"])&&u.call(i)}finally{if(c)throw c.error}}return[2,this.videoInputDevices]}})})},e}();v.decorators=[{type:t.Component,args:[{selector:"zxing-scanner",template:'<video #preview [style.object-fit]="previewFitMode">\n    <p>\n        Your browser does not support this feature, please try to upgrade it.\n    </p>\n    <p>\n        Seu navegador não suporta este recurso, por favor tente atualizá-lo.\n    </p>\n</video>\n',styles:[":host{display:block}video{width:100%;height:auto;-o-object-fit:contain;object-fit:contain}"],changeDetection:t.ChangeDetectionStrategy.OnPush}]}],v.ctorParameters=function(){return[]},v.propDecorators={previewElemRef:[{type:t.ViewChild,args:["preview"]}],formats:[{type:t.Input}],scannerEnabled:[{type:t.Input}],device:[{type:t.Input}],autofocusEnabled:[{type:t.Input}],previewFitMode:[{type:t.Input}],torch:[{type:t.Input}],torchCompatible:[{type:t.Output}],scanSuccess:[{type:t.Output}],scanFailure:[{type:t.Output}],scanError:[{type:t.Output}],scanComplete:[{type:t.Output}],camerasFound:[{type:t.Output}],camerasNotFound:[{type:t.Output}],permissionResponse:[{type:t.Output}],hasDevices:[{type:t.Output}]};var m=function(){function e(){}return e.forRoot=function(){return{ngModule:e}},e}();m.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule,s.FormsModule],declarations:[v],exports:[v]}]}],e.ZXingScannerModule=m,e.ɵa=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=zxing-ngx-scanner.umd.min.js.map
